# 华为云架构模式

本文档整理常见业务场景的华为云架构方案，用于快速匹配用户需求。

## 目录

1. [Web 应用架构](#1-web-应用架构)
2. [微服务架构](#2-微服务架构)
3. [高可用架构](#3-高可用架构)
4. [大数据架构](#4-大数据架构)
5. [AI/ML 架构](#5-aiml-架构)
6. [混合云架构](#6-混合云架构)

---

## 1. Web 应用架构

### 1.1 小型 Web 应用

**适用场景：** 个人博客、小型企业官网、内部管理系统

**架构组件：**

```
用户 → EIP → ECS → RDS MySQL
              ↓
             OBS (静态资源)
```

**资源配置：**

| 组件 | 规格 | 数量 | 说明 |
|------|------|------|------|
| ECS | s6.large.2 | 1 | Web服务器 |
| RDS MySQL | c6.large.2 | 1 | 主数据库 |
| EVS | 高IO 100GB | 1 | 数据盘 |
| OBS | 标准存储 | 50GB | 静态资源 |
| EIP | 5Mbps | 1 | 公网访问 |

**预估成本：** ¥500-800/月

**适用条件：**
- 日活 < 1000
- 可接受单点故障（非关键业务）
- 预算有限

---

### 1.2 中型 Web 应用

**适用场景：** 电商平台、SaaS应用、中型门户网站

**架构组件：**

```
用户 → ELB → ECS × 2 → RDS 主备
              ↓         ↓
             OBS     DCS Redis
              ↓
            CDN (可选)
```

**资源配置：**

| 组件 | 规格 | 数量 | 说明 |
|------|------|------|------|
| ECS | s6.xlarge.2 | 2 | 应用服务器集群 |
| ELB | 共享型 | 1 | 负载均衡 |
| RDS MySQL | c6.xlarge.2 | 2 | 主备实例 |
| DCS Redis | 2GB 主备 | 1 | 缓存/会话 |
| EVS | 高IO 200GB | 2 | 数据盘 |
| OBS | 标准存储 | 200GB | 静态资源/备份 |
| EIP | 20Mbps | 1 | NAT网关出站 |

**预估成本：** ¥2000-3500/月

**适用条件：**
- 日活 1000-50000
- 需要高可用
- 有一定预算

---

### 1.3 大型 Web 应用

**适用场景：** 大型电商、社交平台、高流量网站

**架构组件：**

```
用户 → CDN → WAF → ELB → ECS 集群
                           ↓
                    API网关 → 微服务
                           ↓
              RDS 集群 + DCS 集群 + DDS
                           ↓
                         OBS + SFS
```

**资源配置：**

| 组件 | 规格 | 数量 | 说明 |
|------|------|------|------|
| ECS | c6.2xlarge.2 | 4+ | 应用服务器 |
| ELB | 独享型 | 2 | 负载均衡（多可用区） |
| RDS MySQL | c6.4xlarge.2 | 3 | 一主两备 + 只读实例 |
| DCS Redis | 32GB 集群 | 1 | 分布式缓存 |
| DDS | 集群 | 1 | 文档存储 |
| APIG | 专享版 | 1 | API网关 |
| WAF | 专业版 | 1 | 安全防护 |
| CDN | - | - | 全站加速 |

**预估成本：** ¥10000+/月

---

## 2. 微服务架构

### 2.1 基础微服务

**适用场景：** 中型互联网应用、企业数字化平台

**架构组件：**

```
用户 → ELB → CCE 集群 → RDS/GaussDB
              ↓           ↓
         APIG (可选)   DCS Redis
              ↓
         DMS (消息队列)
```

**资源配置：**

| 组件 | 规格 | 数量 | 说明 |
|------|------|------|------|
| CCE | 3节点 s6.xlarge.2 | 1集群 | 容器平台 |
| RDS MySQL | c6.xlarge.2 | 2 | 主备 |
| DCS Redis | 4GB 主备 | 1 | 缓存 |
| DMS Kafka | 3节点 | 1 | 消息队列 |
| ELB | 共享型 | 1 | 入口负载 |

**预估成本：** ¥4000-6000/月

---

### 2.2 云原生微服务

**适用场景：** 大型互联网应用、高并发系统

**架构组件：**

```
用户 → CDN → WAF → ELB → CCE 集群
                           ↓
         ┌─────────────────┴─────────────────┐
         ↓                  ↓                ↓
    APIG (服务网格)    DCS Redis 集群    DMS RocketMQ
         ↓                  ↓                ↓
    GaussDB 分布式     DDS MongoDB      OBS 数据湖
```

**资源配置：**

| 组件 | 规格 | 数量 | 说明 |
|------|------|------|------|
| CCE | 6节点 c6.2xlarge.2 | 1集群 | 生产+测试 |
| GaussDB | 分布式版 | 1 | 分布式事务 |
| DCS Redis | 64GB 集群 | 1 | 高性能缓存 |
| DDS | 集群版 | 1 | 文档存储 |
| DMS RocketMQ | 5节点 | 1 | 事务消息 |
| APIG | 专享版 | 1 | 服务网关 |
| ServiceStage | - | - | 微服务治理 |

**预估成本：** ¥15000+/月

---

## 3. 高可用架构

### 3.1 多可用区部署

**架构组件：**

```
用户 → ELB (跨AZ)
         ↓
    ┌────┴────┐
    ↓         ↓
  AZ-1      AZ-2
ECS × 2    ECS × 2
    ↓         ↓
  RDS主    RDS备
```

**关键配置：**

| 配置项 | 建议 |
|--------|------|
| 可用区 | 至少2个 |
| ECS分布 | 每AZ至少1台 |
| RDS | 主备跨AZ |
| ELB | 跨AZ分发 |
| VPC子网 | 每AZ一个子网 |

**成本增加：** 约20-30%（相比单AZ）

---

### 3.2 灾备架构

**架构组件：**

```
主区域 (华北-北京)          备区域 (华东-上海)
┌─────────────────┐        ┌─────────────────┐
│ ECS + RDS + OBS │ ←DNS→  │ ECS + RDS + OBS │
└─────────────────┘        └─────────────────┘
        ↓                          ↓
    CBR 备份 ─────────────────→ CBR 复制
```

**关键配置：**

| 配置项 | 建议 |
|--------|------|
| RDS | 跨区域只读实例 |
| OBS | 跨区域复制 |
| DNS | 健康检查 + 故障切换 |
| CBR | 跨区域备份复制 |

**RTO/RPO：**
- 热备：RTO < 30分钟，RPO < 5分钟
- 冷备：RTO < 4小时，RPO < 1小时

---

## 4. 大数据架构

### 4.1 数据湖架构

**适用场景：** 数据分析、BI报表、数据中台

**架构组件：**

```
数据源 → DIS → OBS 数据湖
                  ↓
             MRS 集群 (Spark/Hive)
                  ↓
             DWS 数据仓库
                  ↓
             BI工具 (QuickBI)
```

**资源配置：**

| 组件 | 规格 | 数量 | 说明 |
|------|------|------|------|
| OBS | 标准存储 | 10TB+ | 数据湖存储 |
| MRS | 分析集群 | 1 | Spark/Hive |
| DWS | 8节点 | 1 | 数据仓库 |
| DIS | 标准通道 | - | 数据接入 |

**预估成本：** ¥8000+/月（不含存储）

---

### 4.2 实时数据处理

**适用场景：** 实时推荐、风控系统、监控告警

**架构组件：**

```
数据源 → DIS → DMS Kafka
                    ↓
              Flink (MRS Streaming)
                    ↓
         ┌──────────┼──────────┐
         ↓          ↓          ↓
      DWS        Redis      Elasticsearch
```

**资源配置：**

| 组件 | 规格 | 数量 | 说明 |
|------|------|------|------|
| DIS | 高级通道 | - | 实时数据流 |
| DMS Kafka | 5节点 | 1 | 消息缓冲 |
| MRS Streaming | 流式集群 | 1 | Flink计算 |
| DCS Redis | 集群 | 1 | 实时状态 |
| DWS | 4节点 | 1 | 结果存储 |

**预估成本：** ¥12000+/月

---

## 5. AI/ML 架构

### 5.1 模型训练平台

**适用场景：** AI模型开发、大规模训练

**架构组件：**

```
数据 → OBS 数据集
          ↓
     ModelArts 训练
          ↓
     OBS 模型存储
          ↓
     ModelArts 推理部署
          ↓
       APIG 对外服务
```

**资源配置：**

| 组件 | 规格 | 数量 | 说明 |
|------|------|------|------|
| OBS | 标准存储 | 1TB+ | 数据/模型存储 |
| ModelArts | GPU训练 | 按需 | 训练任务 |
| ModelArts | 推理实例 | 按需 | 在线推理 |
| GPU ECS | Pi2 | 按需 | 大规模训练 |

**预估成本：** 按训练时长计费

---

### 5.2 AI 应用部署

**适用场景：** AI服务对外提供

**架构组件：**

```
用户 → ELB → GPU ECS 集群
                 ↓
            ModelArts 推理
                 ↓
            OBS (模型)
                 ↓
            RDS (日志/结果)
```

**资源配置：**

| 组件 | 规格 | 数量 | 说明 |
|------|------|------|------|
| GPU ECS | Pi2.2xlarge | 2+ | 推理服务 |
| ELB | 独享型 | 1 | 流量分发 |
| OBS | 标准存储 | 100GB | 模型存储 |
| RDS | c6.large.2 | 1 | 元数据 |

---

## 6. 混合云架构

### 6.1 本地数据中心互联

**适用场景：** 本地有IDC，需要扩展到云端

**架构组件：**

```
本地数据中心 ←→ VPN/DC ←→ VPC
                                ↓
                            云上资源
                        (ECS/RDS/OBS)
```

**连接方式：**

| 方式 | 带宽 | 延迟 | 成本 | 适用场景 |
|------|------|------|------|----------|
| VPN | 100-200Mbps | 中 | 低 | 小流量、非关键 |
| Direct Connect | 1-10Gbps | 低 | 高 | 大流量、关键业务 |
| 云连接 CC | 跨区域 | 低 | 中 | 多地域互联 |

---

### 6.2 云边协同

**适用场景：** IoT、边缘计算

**架构组件：**

```
边缘节点 (IES) ←→ 云端控制
     ↓
本地设备接入
     ↓
数据处理 → 云端分析
```

---

## 架构选择决策树

```
用户描述需求
    ↓
是Web应用吗？
    ├─ 是 → 日活规模？
    │       ├─ <1000 → 小型Web架构
    │       ├─ 1000-50000 → 中型Web架构
    │       └─ >50000 → 大型Web架构
    │
    ├─ 是微服务吗？
    │       ├─ 中型 → 基础微服务
    │       └─ 大型 → 云原生微服务
    │
    ├─ 是大数据吗？
    │       ├─ 离线分析 → 数据湖架构
    │       └─ 实时处理 → 实时数据处理
    │
    ├─ 是AI吗？
    │       ├─ 模型训练 → 训练平台架构
    │       └─ 模型部署 → AI应用部署
    │
    └─ 有本地IDC？ → 混合云架构
```

---

## 最佳实践

### 安全建议
1. VPC隔离，安全组最小权限
2. 敏感数据加密存储
3. 启用 WAF 防护
4. 定期安全审计

### 成本优化
1. 合理选择规格，避免过度配置
2. 使用包年包月获取折扣
3. OBS 生命周期管理
4. 闲置资源及时释放

### 运维建议
1. 启用云监控告警
2. 配置日志收集
3. 定期备份
4. 制定故障应急预案

---

*注：本文档为基础参考，实际架构需根据具体需求调整。*
